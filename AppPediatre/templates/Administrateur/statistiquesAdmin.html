{% extends 'Administrateur/base_admin.html' %}
{% load static %}
{% block title %}<title>Tableau de bord</title>{% endblock %}
{% block import %}

{% endblock %}
{% block sideBar %}
<ul>
    <li class="menu-title"><span>Menu</span></li>
    <li>
        <a href="{% url 'index_admin' %}"><i data-feather="home"></i> <span>tableau de bord</span></a>
    </li>
    <li class="active">
        <a><i data-feather="pie-chart"></i> <span> Statistiques</span> </a>
    </li>
    <li>
        <a href="#"><i data-feather="bell"></i> <span>Actualités</span><span
                class="menu-arrow"></span></a>
        <ul>
            <li><a href="{% url 'affichage_actualite' %}">Toutes les actualités</a></li>
            <li><a href="{% url 'ajout_actualite' %}">Ajouter une actualité</a></li>
        </ul>
    </li>
    <li>
        <a href="{% url 'chatAdmin' %}"><i data-feather="mail"></i> <span>Messagerie</span></a>
    </li>
    <li class="menu-title"><span>Gestion Comptes</span></li>
    <li>
        <a href="{% url 'gestion_administrateurs' %}"><i data-feather="lock"></i> <span> Administrateurs </span></a>
    </li>
    <li>
        <a href="{% url 'gestion_patients' %}"><i data-feather="users"></i>
            <span>Patients</span></a>
    </li>
    <li>
        <a href="{% url 'gestion_pediatre' %}"><i data-feather="clipboard"></i><span>Pédiatres</span></a>
    </li>


    <li class="menu-title">
        <span>Gestion media</span>
    </li>
    <li>
        <a href="#"><i data-feather="video"></i> <span>Videos</span><span
                class="menu-arrow"></span></a>
        <ul>
            <li><a href="{% url 'affichage_video' %}">Toutes les videos</a></li>
            <li><a href="{% url 'ajout_video' %}">Ajouter une video</a></li>
        </ul>
    </li>
    <li>
        <a href="#"><i data-feather="image"></i> <span>Images</span><span
                class="menu-arrow"></span></a>
        <ul>
            <li><a href="{% url 'affichage_image' %}">Toutes les images</a></li>
            <li><a href="{% url 'ajout_image' %}">Ajouter une image</a></li>
        </ul>
    </li>
    <li class="menu-title">
        <span>Autre</span>
    </li>
    <li>
        <a href="{% url 'parametres' %}"><i data-feather="phone"></i> <span>Contact</span></a>
    </li>
</ul>
{% endblock %}
{% block contenu %}
{% if error == True %}
<div class="row">
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        {{ errorMsg }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
</div>
{% endif %}
<div class="page-header">
    <div class="row align-items-center">
        <div class="col">
            <h3 class="page-title">Patients</h3>
            <ul class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'index_admin' %}">Tableau de bord</a>
                </li>
                <li class="breadcrumb-item active">Statistiques</li>
            </ul>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-xl-12 d-flex">
        <div class="card flex-fill">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="card-title">
                        <div id="chart_title">Sexe</div>
                    </h5>
                    <div class="dropdown">
                        <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenu2"
                                data-bs-toggle="dropdown" aria-expanded="false">
                            Repartition par
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="dropdownMenu2">
                            <li>
                                <button class="dropdown-item" id="Sexe" type="button">Sexe</button>
                            </li>
                            <li>
                                <button class="dropdown-item" id="Couverture_medicale" type="button">Couverture
                                    medicale
                                </button>
                            </li>
                            <li>
                                <button class="dropdown-item" id="Region" type="button">Region</button>
                            </li>
                            <li>
                                <button class="dropdown-item" id="Ville" type="button">Ville</button>
                            </li>
                            <li>
                                <button class="dropdown-item" id="Parents_consanguins" type="button">Parents
                                    consanguins
                                </button>
                            </li>
                            <li>
                                <button class="dropdown-item" id="Grossesse_suivi" type="button">Grossesse suivi
                                </button>
                            </li>
                            <li>
                                <button class="dropdown-item" id="Terme_de_la_grossesse" type="button">Terme de la
                                    grossesse
                                </button>
                            </li>
                            <li>
                                <button class="dropdown-item" id="Accouchement_par_voie" type="button">Accouchement
                                    par voie
                                </button>
                            </li>
                            <li>
                                <button class="dropdown-item" id="Souffrance_Néonatale" type="button">Souffrance
                                    Néonatale
                                </button>
                            </li>
                            <li>
                                <button class="dropdown-item" id="Poids_de_naissance" type="button"> Poids
                                    de naissance (en Kg)
                                </button>
                            </li>
                            <li>
                                <button class="dropdown-item" id="han" type="button">
                                    Hospitalisation à l'âge Néonatal
                                </button>
                            </li>
                            <li>
                                <button class="dropdown-item" id="Allaitement" type="button">Allaitement</button>
                            </li>
                            <li>
                                <button class="dropdown-item" id="rsp" type="button">
                                    Retentissement Staturo-Pondérale
                                </button>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div id="chart_draw"></div>
                <script>
                        // Fetch data from the Django view
                        const fetchData = async () => {
                            try {
                                const response = await fetch('/administrateur/pie_chart_sexe/');
                                const data = await response.json();

                                // Convert the data into an array of columns for the chart
                                const chartData = data.map(item => [item.sexe, item.count]);

                                // Generate the chart
                                const chart = c3.generate({
                                    bindto: '#chart_draw',
                                    data: {
                                        columns: chartData,
                                        type: 'pie',
                                        colors: {
                                            Masculin: '#1844a6',
                                            Féminin: '#fca5ba',
                                            Autre: '#7ed075',
                                        }
                                    }
                                });
                            } catch (error) {
                                console.error('Error fetching data:', error);
                            }
                        };

                        // Fetch data and generate the chart
                        fetchData();



                </script>
            </div>
        </div>
    </div>
</div>
<script>
        $(document).ready(function () {
            // Chart code for "Sexe" button
            $('#Sexe').click(function () {
                // Update chart title
                $('#chart_title').text('Sexe');

                // Fetch data from the Django view
                const fetchData = async () => {
                    try {
                        const response = await fetch('/administrateur/pie_chart_sexe/');
                        const data = await response.json();

                        // Convert the data into an array of columns for the chart
                        const chartData = data.map(item => [item.sexe, item.count]);

                        // Generate the chart
                        const chart = c3.generate({
                            bindto: '#chart_draw',
                            data: {
                                columns: chartData,
                                type: 'pie',
                                colors: {
                                    Masculin: '#1844a6',
                                    Féminin: '#fca5ba',
                                    Autre: '#7ed075',
                                }
                            }
                        });
                    } catch (error) {
                        console.error('Error fetching data:', error);
                    }
                };

                // Fetch data and generate the chart
                fetchData();
            });
            //---------------------------------
            $('#Couverture_medicale').click(function () {
                // Update chart title
                $('#chart_title').text('Couverture medicale');

                const fetchData2 = async () => {
                    try {
                        const response2 = await fetch('/administrateur/pie_chart_cm/');
                        const data2 = await response2.json();

                        // Convert the data into an array of columns for the chart
                        const chartData2 = data2.map(item => [item.cm, item.count]);

                        // Generate the chart
                        const chart2 = c3.generate({
                            bindto: '#chart_draw',
                            data: {
                                columns: chartData2,
                                type: 'pie',
                                colors: {
                                    Mutualiste: '#bb555f',
                                    NonMutualiste: '#868686',
                                }
                            }
                        });
                    } catch (error) {
                        console.error('Error fetching data:', error);
                    }
                };
                fetchData2();
            });
            //---------------------------------
            $('#Region').click(function () {
                // Update chart title
                $('#chart_title').text('Region');

                const fetchData1 = async () => {
                    try {
                        const response1 = await fetch('/administrateur/pie_chart_region/');
                        const data1 = await response1.json();

                        // Convert the data into an array of columns for the chart
                        const chartData1 = data1.map(item => [item.region, item.count]);

                        // Generate the chart
                        const chart1 = c3.generate({
                            bindto: '#chart_draw',
                            data: {
                                columns: chartData1,
                                type: 'pie',
                            }
                        });
                    } catch (error) {
                        console.error('Error fetching data:', error);
                    }
                };
                fetchData1();
            });
            //-------------------------------
            $('#Ville').click(function () {
                // Update chart title
                $('#chart_title').text('Ville');

                const fetchData3 = async () => {
                    try {
                        const response3 = await fetch('/administrateur/pie_chart_ville/');
                        const data3 = await response3.json();

                        // Convert the data into an array of columns for the chart
                        const chartData3 = data3.map(item => [item.ville, item.count]);

                        // Generate the chart
                        const chart3 = c3.generate({
                            bindto: '#chart_draw',
                            data: {
                                columns: chartData3,
                                type: 'pie',
                            }
                        });
                    } catch (error) {
                        console.error('Error fetching data:', error);
                    }
                };
                fetchData3();
            });
            //-----------------------------
            $('#Parents_consanguins').click(function () {
                // Update chart title
                $('#chart_title').text('Parents consanguins');

                const fetchData4 = async () => {
                    try {
                        const response4 = await fetch('/administrateur/pie_chart_pc/');
                        const data4 = await response4.json();

                        // Convert the data into an array of columns for the chart
                        const chartData4 = data4.map(item => [item.pc, item.count]);

                        // Generate the chart
                        const chart4 = c3.generate({
                            bindto: '#chart_draw',
                            data: {
                                columns: chartData4,
                                type: 'pie',
                                colors: {
                                    Oui: '#66c6f3',
                                    Non: '#decb00',
                                }
                            }
                        });
                    } catch (error) {
                        console.error('Error fetching data:', error);
                    }
                };
                fetchData4();
            });
            //---------------------------------------
            $('#Grossesse_suivi').click(function () {
                // Update chart title
                $('#chart_title').text('Grossesse suivi');

                const fetchData5 = async () => {
                    try {
                        const response5 = await fetch('/administrateur/pie_chart_gs/');
                        const data5 = await response5.json();

                        // Convert the data into an array of columns for the chart
                        const chartData5 = data5.map(item => [item.gs, item.count]);

                        // Generate the chart
                        const chart5 = c3.generate({
                            bindto: '#chart_draw',
                            data: {
                                columns: chartData5,
                                type: 'pie',
                                colors: {
                                    Oui: '#a1bdcc',
                                    Non: '#3b3b3b',
                                }
                            }
                        });
                    } catch (error) {
                        console.error('Error fetching data:', error);
                    }
                };
                fetchData5();
            });
            //---------------------------------
            $('#Terme_de_la_grossesse').click(function () {
                // Update chart title
                $('#chart_title').text('Terme de la grossesse');

                const fetchData6 = async () => {
                    try {
                        const response6 = await fetch('/administrateur/pie_chart_tg/');
                        const data6 = await response6.json();

                        // Convert the data into an array of columns for the chart
                        const chartData6 = data6.map(item => [item.tg, item.count]);

                        // Generate the chart
                        const chart6 = c3.generate({
                            bindto: '#chart_draw',
                            data: {
                                columns: chartData6,
                                type: 'pie',
                                colors: {
                                    'A terme': '#02fd53',
                                    Prématuré: '#2f0da9',
                                }
                            }
                        });
                    } catch (error) {
                        console.error('Error fetching data:', error);
                    }
                };
                fetchData6();
            });
            //---------------------------------
            $('#Accouchement_par_voie').click(function () {
                // Update chart title
                $('#chart_title').text('Accouchement par voie');
                const fetchData7 = async () => {
                    try {
                        const response7 = await fetch('/administrateur/pie_chart_av/');
                        const data7 = await response7.json();

                        // Convert the data into an array of columns for the chart
                        const chartData7 = data7.map(item => [item.av, item.count]);

                        // Generate the chart
                        const chart7 = c3.generate({
                            bindto: '#chart_draw',
                            data: {
                                columns: chartData7,
                                type: 'pie',
                                colors: {
                                    Basse: '#51445d',
                                    Césarienne: '#ff907a',
                                }
                            }
                        });
                    } catch (error) {
                        console.error('Error fetching data:', error);
                    }
                };
                fetchData7();

            });
            //----------------------------------
            $('#Souffrance_Néonatale').click(function () {
                // Update chart title
                $('#chart_title').text('Souffrance néonatale');

                const fetchData8 = async () => {
                    try {
                        const response8 = await fetch('/administrateur/pie_chart_sn/');
                        const data8 = await response8.json();

                        // Convert the data into an array of columns for the chart
                        const chartData8 = data8.map(item => [item.sn, item.count]);

                        // Generate the chart
                        const chart8 = c3.generate({
                            bindto: '#chart_draw',
                            data: {
                                columns: chartData8,
                                type: 'pie',
                                colors: {
                                    Oui: '#B9F3E4',
                                    Non: '#EA8FEA',
                                }
                            }
                        });
                    } catch (error) {
                        console.error('Error fetching data:', error);
                    }
                };
                fetchData8();
            });
            //------------------------------
            $('#Poids_de_naissance').click(function () {
                // Update chart title
                $('#chart_title').text('Poids de naissance (en Kg)');

                const fetchData9 = async () => {
                    try {
                        const response9 = await fetch('/administrateur/pie_chart_pn/');
                        const data9 = await response9.json();

                        // Convert the data into an array of columns for the chart
                        const chartData9 = data9.map(item => [item.pn, item.count]);

                        // Generate the chart
                        const chart9 = c3.generate({
                            bindto: '#chart_draw',
                            data: {
                                columns: chartData9,
                                type: 'pie',
                                colors: {
                                    "< 2Kg": '#EA047E',
                                    "2--2,5Kg": '#FF6D28',
                                    "2,5--4Kg": '#FCE700',
                                    "> 4Kg": '#00F5FF',
                                }
                            }
                        });
                    } catch (error) {
                        console.error('Error fetching data:', error);
                    }
                };
                fetchData9();
            });
//------------------------------
            $('#han').click(function () {
                // Update chart title
                $('#chart_title').text("Hospitalisation à l'âge Néonatal");

                const fetchData10 = async () => {
                    try {
                        const response10 = await fetch('/administrateur/pie_chart_han/');
                        const data10 = await response10.json();

                        // Convert the data into an array of columns for the chart
                        const chartData10 = data10.map(item => [item.han, item.count]);

                        // Generate the chart
                        const chart10 = c3.generate({
                            bindto: '#chart_draw',
                            data: {
                                columns: chartData10,
                                type: 'pie',
                                colors: {
                                    Oui: '#E21818',
                                    Non: '#98DFD6',
                                }
                            }
                        });
                    } catch (error) {
                        console.error('Error fetching data:', error);
                    }
                };
                fetchData10();
            });
//------------------------------
            $('#Allaitement').click(function () {
                // Update chart title
                $('#chart_title').text('Allaitement');
                const fetchData11 = async () => {
                    try {
                        const response11 = await fetch('/administrateur/pie_chart_allaitement/');
                        const data11 = await response11.json();

                        // Convert the data into an array of columns for the chart
                        const chartData11 = data11.map(item => [item.allaitement, item.count]);

                        // Generate the chart
                        const chart11 = c3.generate({
                            bindto: '#chart_draw',
                            data: {
                                columns: chartData11,
                                type: 'pie',
                                colors: {
                                    Maternel: '#F2E3DB',
                                    Mixte: '#41644A',
                                    Artificiel: '#E86A33',
                                }
                            }
                        });
                    } catch (error) {
                        console.error('Error fetching data:', error);
                    }
                };
                fetchData11();

            });
            //------------------------------
            $('#rsp').click(function () {
                // Update chart title
                $('#chart_title').text('Retentissement Staturo-Pondérale');
                const fetchData12 = async () => {
                    try {
                        const response12 = await fetch('/administrateur/pie_chart_rsp/');
                        const data12 = await response12.json();

                        // Convert the data into an array of columns for the chart
                        const chartData12 = data12.map(item => [item.rsp, item.count]);

                        // Generate the chart
                        const chart12 = c3.generate({
                            bindto: '#chart_draw',
                            data: {
                                columns: chartData12,
                                type: 'pie',
                                colors: {
                                    Retard: '#3330E4',
                                    Stagnation: '#F637EC',
                                    Bon: '#FAEA48',
                                }
                            }
                        });
                    } catch (error) {
                        console.error('Error fetching data:', error);
                    }
                };
                fetchData12();

            });

        });




</script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.16.0/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.7.20/c3.min.js"></script>
<script src="{% static 'plugins/datatables/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'plugins/datatables/datatables.min.js' %}"></script>
{% endblock %}